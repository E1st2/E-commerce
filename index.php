<?php include 'includes/header.php'; ?> <main class="main"> <div class="container"> <div class="hero"> <h2>Welcome to X-Women Wide World</h2> <p>Discover amazing products at great prices</p> <?php if ($current_user): ?> <!-- Updated banner to show discount for all account holders --> <div class="student-banner"> ðŸŽ‰ Account Discount Active: Get 5% off all products! </div> <?php endif; ?> <!-- Added clear cart button --> <div style="margin-top: 1rem;"> <button onclick="clearCart()" class="btn btn-secondary" style="background-color: #ef4444;"> Clear Cart </button> </div> </div> <div class="search-filter-section"> <input type="text" id="search-input" class="search-input" placeholder="Search products..." onkeyup="filterProducts()" > <select id="category-filter" class="category-filter" onchange="filterProducts()"> <option value="">All Categories</option> <?php $categories_query = "SELECT * FROM categories"; $categories_result = $conn->query($categories_query); while ($category = $categories_result->fetch_assoc()): ?> <option value="<?php echo $category['id']; ?>"> <?php echo htmlspecialchars($category['name']); ?> </option> <?php endwhile; ?> </select> </div> <?php if ($current_user): ?> <section class="suggestions-section"> <h3>Recommended for You</h3> <div id="suggestions-container"></div> </section> <?php endif; ?> <section class="products-section"> <h3>All Products</h3> <div class="products-grid" id="products-grid"> <?php $products_query = "SELECT p.*, c.name as category_name FROM products p LEFT JOIN categories c ON p.category_id = c.id WHERE p.stock > 0"; $products_result = $conn->query($products_query); while ($product = $products_result->fetch_assoc()): $display_price = $current_user ? calculate_price($product['price'], true) : $product['price']; ?> <div class="product-card" data-category="<?php echo $product['category_id']; ?>" data-name="<?php echo strtolower($product['name']); ?>"> <!-- Updated image path to use BASE_URL constant --> <img src="/images/<?php echo htmlspecialchars($product['image_url']); ?>" alt="<?php echo htmlspecialchars($product['name']); ?>" onerror="this.onerror=null; this.src='/images/placeholder.jpg'"> <div class="product-info"> <h4><?php echo htmlspecialchars($product['name']); ?></h4> <p class="category-tag"><?php echo htmlspecialchars($product['category_name']); ?></p> <p class="product-description"> <?php echo htmlspecialchars(substr($product['description'], 0, 80)) . '...'; ?> </p> <div class="price-section"> <!-- Show discount for all logged-in users --> <?php if ($current_user): ?> <span class="original-price"><?php echo format_currency($product['price']); ?></span> <span class="discounted-price"><?php echo format_currency($display_price); ?></span> <?php else: ?> <span class="price"><?php echo format_currency($product['price']); ?></span> <?php endif; ?> </div> <div class="product-actions"> <!-- Fixed links to use BASE_URL --> <a href="/product.php?id=<?php echo $product['id']; ?>" class="btn btn-secondary"> View Details </a> <button class="btn btn-primary" onclick='addToCart(<?php echo json_encode([ "id" => $product["id"], "name" => $product["name"], "price" => (float)$product["price"], "image" => $product["image_url"] ]); ?>)'> Add to Cart </button> </div> </div> </div> <?php endwhile; ?> </div> </section> </div> </main> <?php if ($current_user): ?> <!-- React 18 CDN --> <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script> <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script> <script> // Load product suggestions using React const userId = <?php echo $current_user['id']; ?>; fetch(/api/suggestions.php?user_id=${userId}) .then(res => res.json()) .then(data => { if (data.success && data.products.length > 0) { const container = document.getElementById('suggestions-container'); const SuggestionsComponent = () => { return React.createElement('div', { className: 'products-grid' }, data.products.map(product => React.createElement('div', { key: product.id, className: 'product-card' }, [ React.createElement('img', { src: product.image_url, alt: product.name, onError: (e) => e.target.src = '/images/placeholder.jpg' }), React.createElement('div', { className: 'product-info' }, [ React.createElement('h4', {}, product.name), React.createElement('p', { className: 'price' }, ${parseFloat(product.price).toFixed(0)} XAF), React.createElement('button', { className: 'btn btn-primary', onClick: () => addToCart(product) }, 'Add to Cart') ]) ]) ) ); }; const root = ReactDOM.createRoot(container); root.render(React.createElement(SuggestionsComponent)); } }); </script> <?php endif; ?> <?php include 'includes/footer.php'; ?>